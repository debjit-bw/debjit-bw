<!DOCTYPE html>
<html>

<head>
    <title>Debjit Bhowal - Portfolio</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <script src="https://www.google.com/recaptcha/api.js?render=6LeNhigmAAAAAOURwWroLKWb07nb7O0ZSEpxXNEn"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>

<body>
    <header>
        <h1>Debjit Bhowal</h1>
        <h2>Developer, Engineer</h2>
        <p class="thoughts"></p>
    </header>
    <div id="chatbox">
        <div id="messages"></div>
        <input type="text" id="user-input" placeholder="Ask me anything...">
        <button id="send-button">
            <i class="fas fa-arrow-right" id="send-icon"></i>
            <i class="fas fa-spinner fa-spin fa-pulse" id="loading-icon" style="display:none;"></i>
        </button>

    </div>
    <nav>
        <ul>
            <li><a href="https://github.com/debjit-bw">GitHub</a></li>
            <li><a href="https://www.linkedin.com/in/debjit-bhowal/">LinkedIn</a></li>
            <li><a href="https://blog.debjit.dev">Blog</a></li>
            <li><a href="mailto:hello@debjit.dev">Email</a></li>
        </ul>
    </nav>
    <br><br><br>
    <div class="timeline">
        <div>
            <a class="twitter-timeline" data-width="800" data-theme="dark"
                href="https://twitter.com/BhowalDebjit?ref_src=twsrc%5Etfw">Fetching opinions</a>
            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div>
    </div>

</body>

<script>
    // Define an array of sentences
    var sentences = [
        "What's your best hotfix?",
        "Favourite hype word to trick VCs?",
        "You fellow rustacean?",
        "Can you code in assembly?",
    ];

    var prompts = [
        "Why did you start blogging?",
        "Tell be about the fire fighting robot",
        "How did you use DALL-E to generate the blog covers?",
        "What about the project on mental health?",
        "What's a recent project you worked on?",
    ]

    var chat_id = null;

    // Select a random sentence from the array
    var randomSentence = sentences[Math.floor(Math.random() * sentences.length)];

    // Update the text of the paragraph element with the "my-text" class on page load
    window.onload = function () {
        var myParagraph = document.querySelector(".thoughts");
        myParagraph.textContent = randomSentence;

        // var input = document.getElementById('user-input');
        // input.value = "Ask me anything...";
    };

    // Update the initial text every 3 seconds
    var intervalId = setInterval(function () {
        var input = document.getElementById('user-input');
        var randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
        input.value = randomPrompt;
    }, 2000);

    document.getElementById('user-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            document.getElementById('send-button').click();
        }
    });

    document.getElementById('user-input').addEventListener('focus', function () {
        clearInterval(intervalId); // Cancel the interval
    });

    var ws;

    document.getElementById('send-button').addEventListener('click', function () {
        // Hide the send icon and show the loading icon
        document.getElementById('send-icon').style.display = 'none';
        document.getElementById('loading-icon').style.display = '';

        var userInput = document.getElementById('user-input').value;

        // Disable the send button while waiting for the API response
        document.getElementById('send-button').disabled = true;

        grecaptcha.ready(function () {
            console.log("ready");
            grecaptcha.execute('6LeNhigmAAAAAOURwWroLKWb07nb7O0ZSEpxXNEn', { action: 'submit' }).then(function (token) {
                // Make the API call with the user's input and the reCAPTCHA token
                console.log("token: " + token);
                var message = {
                    input: userInput,
                    recaptchaToken: token,
                    chat_id: chat_id
                };

                // Create a new WebSocket connection if it doesn't already exist
                if (!ws || ws.readyState !== WebSocket.OPEN) {
                    ws = new WebSocket('wss://mygpt2-7kxt74l7iq-uc.a.run.app/chat');
                    ws.onmessage = function (event) {
                        var data = JSON.parse(event.data);
                        console.log(data)
                        if (data.type === 'token') {
                            // Handle incoming token here
                            console.log(data.message); // Print the received token

                            // Store the chat_id
                            chat_id = data.chat_id;

                            // Check if the spacer is already present
                            var spacerExists = document.getElementById('spacer');

                            if (!spacerExists) {
                                // Create the spacer div and give it an id
                                var spacerDiv = document.createElement('div');
                                spacerDiv.id = 'spacer';
                                spacerDiv.className = 'spacer';

                                // Insert the spacer div before the input field
                                var inputField = document.getElementById('user-input');
                                inputField.parentNode.insertBefore(spacerDiv, inputField);
                            }

                            // Add the received word to the response div
                            responseDiv.textContent += data.message;
                        } else if (data.type === 'end') {
                            // Handle end of message here
                            console.log('End of message');

                            // Clear the input field and enable the send button
                            document.getElementById('user-input').value = '';
                            document.getElementById('send-button').disabled = false;
                            document.getElementById('user-input').focus();

                            // Show the send icon and hide the loading icon
                            document.getElementById('send-icon').style.display = '';
                            document.getElementById('loading-icon').style.display = 'none';
                        } else if (data.type === 'error') {
                            // Handle error here
                            console.log('Error: ' + data.message);

                            // Clear the input field and enable the send button
                            document.getElementById('user-input').value = '';
                            document.getElementById('send-button').disabled = false;
                            document.getElementById('user-input').focus();

                            // format the error message properly
                            responseDiv.textContent = "something bad happened in the clouds :/";

                            // Show the send icon and hide the loading icon
                            document.getElementById('send-icon').style.display = '';
                            document.getElementById('loading-icon').style.display = 'none';
                        } else if (data.type === 'message') {
                            // Handle message here
                            console.log('Message: ' + data.message);

                            // Add the received message to the response div
                            responseDiv.textContent += data.message + " ";
                        }
                    };
                } else if (ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify(message));
                    document.getElementById('user-input').value = '';
                    console.log("sent")
                }

                // Send the user's message through the WebSocket connection
                ws.onopen = function (event) {
                    console.log("connected")
                    ws.send(JSON.stringify(message));
                    document.getElementById('user-input').value = '';
                    console.log("sent")
                };

                // Create and append user's message div
                var messageDiv = document.createElement('div');
                messageDiv.textContent = userInput;
                messageDiv.classList.add("user-message");
                document.getElementById('messages').appendChild(messageDiv);

                // Create a new response div and append it to the chatbox
                responseDiv = document.createElement('div');
                responseDiv.classList.add("ai-response");
                document.getElementById('messages').appendChild(responseDiv);
            });
        });
    });

</script>

</html>